# Aqua Admin GraphQL Schema
# Schema for the Admin dashboard and delivery worker management

# Extend shared schema
# The shared types are imported from shared-config/graphql/shared-types.graphqls

# Schema definition
schema {
  query: Query
  mutation: Mutation
}

# Admin-specific Query Schema
type Query {
  # Admin queries - Admin only
  admins: [Admin!]!
  admin(id: PrimaryId!): Admin

  # User management - Admin only
  users(input: UserListInput): UserPage!
  user(id: PrimaryId!): User

  # Delivery Worker queries
  deliveryWorkers: [DeliveryWorker!]!
  onlineDeliveryWorkers: [DeliveryWorker!]!
  deliveryWorker(id: PrimaryId!): DeliveryWorker

  # Addresses (for admin management)
  userAddresses(userId: Long): [Address!]!
  addresses: [Address!]!
  address(id: PrimaryId!): Address
  deliveryAddresses: [DeliveryAddress!]!
  deliveryAddress(id: PrimaryId!): DeliveryAddress

  # Products (Admin management)
  products(page: Int = 0, size: Int = 20, status: ProductStatus, keyword: String): ProductPage!
  product(id: PrimaryId!): Product
  productStatistics(dateRange: DateRangeInput): ProductStatistics
  lowStockProducts(threshold: Int = 10): [LowStockAlert!]!
  productsPaginated(input: ProductListInput): ProductPage

  # Enhanced Product Management Queries
  topSalesProducts(limit: Int = 10): [Product!]!
  productsByWaterSource(waterSource: String!): [Product!]!
  productsByPhRange(minPh: BigDecimal!, maxPh: BigDecimal!): [Product!]!
  productsByMinSalesVolume(minVolume: Int!): [Product!]!
  productsByTag(tag: String!): [Product!]!
  waterSourceStatistics: Map!
  specificationStatistics: Map!
  allActiveProducts: [Product!]!
  activeProductsByStatus(status: ProductStatus!): [Product!]!
  productsSortedBySalesVolume: [Product!]!
  productsSortedBySortOrder: [Product!]!

  # Orders (Admin/Delivery perspective)
  order(orderId: PrimaryId!): Order
  orderByNumber(orderNumber: String!): Order
  ordersByUser(userId: PrimaryId!): [Order!]!
  ordersByUserAndStatus(userId: PrimaryId!, status: OrderStatus!): [Order!]!
  ordersByStatus(status: OrderStatus!): [Order!]!

  # Delivery Area queries
  deliveryAreas: [DeliveryArea!]!
  enabledDeliveryAreas: [DeliveryArea!]!
  deliveryArea(id: PrimaryId!): DeliveryArea
  validateAddress(input: ValidateAddressInput!): Boolean!

  # Payment queries (Admin perspective)
  paymentStatus(transactionId: String!): String!
  paymentTransaction(id: String!): PaymentTransaction
  paymentTransactions(
    page: Int = 0
    size: Int = 20
    userId: Long
    status: PaymentStatus
    dateFrom: LocalDateTime
    dateTo: LocalDateTime
    minAmount: BigDecimal
    maxAmount: BigDecimal
  ): [PaymentTransaction!]!
  userPaymentTransactions(userId: PrimaryId!, page: Int = 0, size: Int = 20): [PaymentTransaction!]!
  refundRequests(
    page: Int = 0
    size: Int = 20
    status: RefundStatus
    dateFrom: LocalDateTime
    dateTo: LocalDateTime
  ): [RefundRequest!]!
  refundRequest(id: String!): RefundRequest
  paymentStatistics(dateFrom: LocalDateTime, dateTo: LocalDateTime): PaymentStatistics
  paymentMethodStatistics(dateFrom: LocalDateTime, dateTo: LocalDateTime): [PaymentMethodStats!]!
  suspiciousTransactions(
    page: Int = 0
    size: Int = 20
    dateFrom: LocalDateTime
    dateTo: LocalDateTime
  ): [SuspiciousTransaction!]!
  dailyPaymentStatistics(dateFrom: LocalDateTime!, dateTo: LocalDateTime!): [DailyPaymentStats!]!

  # Statistics and Analytics - Admin only
  orderStatistics(input: DateRangeInput!): OrderStatistics!
  dailyStatistics(input: DateRangeInput!): [DailyStatistic!]!
  weeklyStatistics(input: DateRangeInput!): [WeeklyStatistic!]!
  monthlyStatistics(input: DateRangeInput!): [MonthlyStatistic!]!

  # Regions (for admin)
  regions(level: Int, parentCode: String): [Region!]!
  region(code: String!): Region

  # Admin review queries
  reviews(
    deliveryWorkerId: Long
    minRating: Int
    maxRating: Int
    dateFrom: LocalDateTime
    dateTo: LocalDateTime
    userId: Long
    page: Int
    size: Int
  ): [Review!]!
  deliveryWorkerStatistics(deliveryWorkerId: PrimaryId!): DeliveryWorkerStatisticsResponse
  deliveryWorkerRanking(sortBy: String, minReviews: Int, page: Int, size: Int): [DeliveryWorkerRankingResponse!]!
  deliveryWorkerReviews(deliveryWorkerId: PrimaryId!, page: Int, size: Int): [Review!]!
}

# Admin-specific Mutation Schema
type Mutation {
  # Product Management - Admin only
  createProduct(input: CreateProductInput!): Product!
  updateProduct(id: PrimaryId!, input: UpdateProductInput!): Product!
  deleteProduct(id: PrimaryId!): Boolean!
  increaseStock(productId: PrimaryId!, quantity: Int!): String!
  decreaseStock(productId: PrimaryId!, quantity: Int!): Boolean!
  batchUpdateProducts(input: [ProductUpdateRequest!]!): [Product!]!
  updateProductStatus(productId: PrimaryId!, status: ProductStatus!): Product!

  # Enhanced Product Management Mutations
  onlineProduct(id: PrimaryId!): Product!
  offlineProduct(id: PrimaryId!): Product!
  batchAdjustStock(input: BatchStockAdjustmentInput!): BatchStockAdjustmentResult!

  # Order Management - Admin/Delivery operations
  updateOrderStatus(orderId: PrimaryId!, status: OrderStatus!): Order!

  # Payment Management - Admin operations
  handleWechatCallback(input: WechatCallbackInput!): String!
  refund(input: RefundInput!): Boolean!
  processRefund(input: ProcessRefundInput!): RefundRequest!
  createManualRefund(input: CreateManualRefundInput!): RefundRequest!
  forceCompletePayment(transactionId: String!, adminNote: String!): Boolean!
  forceRefund(transactionId: String!, amount: BigDecimal!, reason: String!, adminNote: String!): Boolean!
  updateTransactionNote(transactionId: String!, note: String!): Boolean!
  freezeSuspiciousTransaction(transactionId: String!, reason: String!): Boolean!
  exportTransactions(input: ExportTransactionsInput!): String!
  updateTransaction(transactionId: String!, input: UpdateTransactionInput!): PaymentTransaction!
  processSuspiciousTransaction(input: ProcessSuspiciousTransactionInput!): SuspiciousTransaction!

  # Delivery Area Management - Admin only
  createDeliveryArea(input: CreateDeliveryAreaInput!): DeliveryArea!
  updateDeliveryArea(id: PrimaryId!, input: CreateDeliveryAreaInput!): DeliveryArea!
  deleteDeliveryArea(id: PrimaryId!): Boolean!

  # Delivery Worker Management - Admin only
  createDeliveryWorker(input: CreateDeliveryWorkerInput!): DeliveryWorker!
  updateDeliveryWorker(workerId: PrimaryId!, input: UpdateDeliveryWorkerInput!): DeliveryWorker!
  deleteDeliveryWorker(workerId: PrimaryId!): Boolean!
  updateWorkerStatus(workerId: PrimaryId!, status: DeliveryWorkerStatus!): DeliveryWorker!

  # Delivery Address Management
  createDeliveryAddress(input: CreateDeliveryAddressInput!): DeliveryAddress!
  updateDeliveryAddress(id: PrimaryId!, input: UpdateDeliveryAddressInput!): DeliveryAddress!
  deleteDeliveryAddress(id: PrimaryId!): Boolean!
  setDefaultDeliveryAddress(id: PrimaryId!): Boolean!
}

# Extend the User type with admin-specific fields
extend type User {
  status: UserStatus!
  role: UserRole!
  email: String!
  balanceCents: Long!
  totalSpentCents: Long!
}
